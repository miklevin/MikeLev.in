---
title: Search
permalink: /search/
layout: default
---

<h1>Search Results</h1>

<div id="full-search-container">
  <input type="text" id="full-search-input" placeholder="Search blog posts..." value="{{ page.query }}">
  <div id="full-results-container"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Check if lunr is already loaded from the site-wide search
  const loadLunr = () => {
    return new Promise((resolve, reject) => {
      if (typeof lunr !== 'undefined') {
        resolve();
        return;
      }
      
      const script = document.createElement('script');
      script.src = "https://unpkg.com/lunr/lunr.js";
      script.onload = resolve;
      script.onerror = reject;
      document.head.appendChild(script);
    });
  };

  // Check for URL query parameter
  const urlParams = new URLSearchParams(window.location.search);
  const queryParam = urlParams.get('q');
  
  // Set input value from URL parameter if available
  if (queryParam) {
    document.getElementById('full-search-input').value = queryParam;
  }

  async function initSearch() {
    try {
      await loadLunr();
      
      // Fetch the search index
      const response = await fetch('/search.json');
      const data = await response.json();
      
      // Initialize lunr with data
      const idx = lunr(function() {
        this.ref('url');
        this.field('title', { boost: 10 });
        this.field('content');
        
        // Only add these fields if they exist
        if (data.length > 0 && data[0].keywords) {
          this.field('keywords', { boost: 5 });
        }
        
        if (data.length > 0 && data[0].description) {
          this.field('description', { boost: 2 });
        }
        
        data.forEach(function(doc) {
          if (doc.title && doc.url) {
            this.add(doc);
          }
        }, this);
      });
      
      // Store the index and data for later use
      window.fullSearchIndex = idx;
      window.fullSearchData = data;
      
      // Set up event listener for search input
      document.getElementById('full-search-input').addEventListener('keyup', performSearch);
      
      // Perform search immediately if query parameter exists
      if (queryParam) {
        performSearch();
      }
    } catch (error) {
      console.error('Failed to initialize search:', error);
      document.getElementById('full-results-container').innerHTML = 
        '<p>Search functionality could not be loaded. Please try again later.</p>';
    }
  }

  function performSearch() {
    const query = document.getElementById('full-search-input').value.trim();
    const resultsContainer = document.getElementById('full-results-container');
    
    if (query === '') {
      resultsContainer.innerHTML = '';
      return;
    }
    
    try {
      const results = window.fullSearchIndex.search(query);
      
      if (results.length === 0) {
        resultsContainer.innerHTML = '<p>No results found</p>';
        return;
      }
      
      // Display all results
      resultsContainer.innerHTML = results
        .map(result => {
          const item = window.fullSearchData.find(post => post.url === result.ref);
          if (!item) return '';
          
          return `
            <div class="search-result">
              <h3><a href="${item.url}">${item.title}</a></h3>
              <p class="date">${item.date}</p>
              ${item.description ? `<p class="description">${item.description}</p>` : ''}
              ${item.keywords ? `<p class="keywords"><small>Keywords: ${item.keywords}</small></p>` : ''}
            </div>
          `;
        })
        .join('');
    } catch (error) {
      console.error('Search error:', error);
      resultsContainer.innerHTML = '<p>Search error occurred. Please try a different query.</p>';
    }
  }

  // Initialize search
  initSearch();
});
</script>

<style>
  #full-search-container {
    margin: 20px 0;
  }
  
  #full-search-input {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-bottom: 20px;
  }
  
  #full-results-container .search-result {
    margin-bottom: 30px;
    padding: 15px;
    border: 1px solid #eee;
    border-radius: 4px;
  }
  
  #full-results-container .search-result:hover {
    background-color: rgba(0,0,0,0.02);
  }
  
  .search-result h3 {
    margin-bottom: 5px;
  }
  
  .search-result .date {
    color: #666;
    font-size: 14px;
    margin-bottom: 10px;
  }
  
  .search-result .description {
    margin-bottom: 5px;
  }
  
  .search-result .keywords {
    color: #666;
  }
</style> 