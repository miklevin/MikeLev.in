---
layout: default
author: Mike Levin
---

{% comment %}
Change this value to switch between absolute and relative URLs:
- true: absolute URLs with domain (for production)
- false: relative URLs without domain (for local testing)
{% endcomment %}
{% assign use_absolute_urls = true %}

{% capture url_base %}{% if use_absolute_urls %}https://mikelev.in{% else %}{% endif %}{% endcapture %}

{% comment %}
Create a flat index of all posts in the correct sort order (same as in list.md)
{% endcomment %}
{% assign sorted_posts = site.posts | sort: 'date' %}
{% assign grouped_posts = sorted_posts | group_by_exp: "post", "post.date | date: '%Y-%m-%d'" | reverse %}
{% assign total_posts = site.posts.size %}

{% assign flat_index = "" | split: "" %}
{% for day in grouped_posts %}
  {% assign day_posts = day.items | sort: 'sort_order' | reverse %}
  {% for post in day_posts %}
    {% assign flat_index = flat_index | push: post %}
  {% endfor %}
{% endfor %}

{% comment %}
Find current post's position in the flat index
{% endcomment %}
{% assign current_position = -1 %}
{% for idx_post in flat_index %}
  {% if idx_post.url == page.url %}
    {% assign current_position = forloop.index0 %}
    {% break %}
  {% endif %}
{% endfor %}

{% comment %}
Determine prev and next posts in the flat index
But flip the direction - "previous" is newer (lower index), "next" is older (higher index)
{% endcomment %}
{% assign custom_prev = nil %}
{% assign custom_next = nil %}
{% assign max_index = flat_index.size | minus: 1 %}

{% if current_position < max_index %}
  {% assign prev_position = current_position | plus: 1 %}
  {% assign custom_prev = flat_index[prev_position] %}
{% endif %}

{% if current_position > 0 %}
  {% assign next_position = current_position | minus: 1 %}
  {% assign custom_next = flat_index[next_position] %}
{% endif %}

<nav class="post-navigation top-nav" itemscope itemtype="https://schema.org/BreadcrumbList">
  {% if custom_prev %}
    <div class="previous-post" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <span class="nav-label">Previous Post</span>
      <a href="{{ url_base }}{{ custom_prev.url }}" itemprop="item">
        <span itemprop="name">{{ custom_prev.title }}</span>
      </a>
      <meta itemprop="position" content="1" />
    </div>
  {% else %}
    <div class="previous-post placeholder"></div>
  {% endif %}
  
  <div class="home-link" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <span class="nav-label">Blog Index</span>
    <a href="{{ url_base }}/" itemprop="item">
      <span itemprop="name">Home</span>
    </a>
    <meta itemprop="position" content="2" />
  </div>
  
  {% if custom_next %}
    <div class="next-post" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <span class="nav-label">Next Post</span>
      <a href="{{ url_base }}{{ custom_next.url }}" itemprop="item">
        <span itemprop="name">{{ custom_next.title }}</span>
      </a>
      <meta itemprop="position" content="3" />
    </div>
  {% else %}
    <div class="next-post placeholder"></div>
  {% endif %}
</nav>

<article itemscope itemtype="http://schema.org/BlogPosting">
  <h1 itemprop="headline">{{ page.title }}</h1>
  <blockquote itemprop="description">{{ page.description }}</blockquote>
  <div itemprop="author" itemscope itemtype="http://schema.org/Person">
    <h3>By <span itemprop="name">{{ page.author | default: site.author }}</span></h3>
  </div>
  <h4>
    <time itemprop="datePublished" datetime="{{ page.date | date_to_xmlschema }}">
      {{ page.date | date: '%A, %B %-d, %Y' }}
    </time>
  </h4>
  <div itemprop="articleBody">
    {{ content }}
  </div>
  <meta itemprop="url" content="{{ site.url }}{{ page.url }}">
  <meta itemprop="mainEntityOfPage" content="{{ site.url }}{{ page.url }}">
  <div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="{{ site.title }}">
    <meta itemprop="url" content="{{ site.url }}">
    <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
      <meta itemprop="url" content="{{ site.url }}/assets/logo.png">
    </div>
  </div>
</article>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": {{ page.title | jsonify }},
  "datePublished": "{{ page.date | date_to_xmlschema }}",
  "dateModified": "{{ page.last_modified_at | default: page.date | date_to_xmlschema }}",
  "author": {
    "@type": "Person",
    "name": {{ page.author | default: site.author | jsonify }}
  },
  "description": {{ page.description | default: page.excerpt | strip_html | strip_newlines | truncate: 160 | jsonify }},
  "url": "{{ site.url }}{{ page.url }}",
  "abstract": {{ page.description | default: page.excerpt | strip_html | strip_newlines | jsonify }},
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ site.url }}{{ page.url }}"
  }{% if page.image %},
  "image": {
    "@type": "ImageObject",
    "url": "{{ site.url }}{{ page.image }}"
  }{% endif %},
  "publisher": {
    "@type": "Organization", 
    "name": {{ site.title | jsonify }},
    "logo": {
      "@type": "ImageObject",
      "url": "{{ site.url }}/assets/logo.png"
    }
  },
  "keywords": {{ page.tags | join: ', ' | jsonify }},
  "wordCount": "{{ content | number_of_words }}"
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {% assign position = 1 %}
    {% if custom_prev %}
    {
      "@type": "ListItem",
      "position": {{ position }},
      "name": {{ custom_prev.title | jsonify }},
      "item": "{{ site.url }}{{ custom_prev.url }}"
    },
    {% assign position = position | plus: 1 %}
    {% endif %}
    {
      "@type": "ListItem", 
      "position": {{ position }},
      "name": "Home",
      "item": "{{ site.url }}"
    }
    {% if custom_next %},
    {% assign position = position | plus: 1 %}
    {
      "@type": "ListItem",
      "position": {{ position }},
      "name": {{ custom_next.title | jsonify }},
      "item": "{{ site.url }}{{ custom_next.url }}"
    }
    {% endif %}
  ]
}
</script>

<nav class="post-navigation bottom-nav" itemscope itemtype="https://schema.org/BreadcrumbList">
  {% if custom_prev %}
    <div class="previous-post" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <span class="nav-label">Previous Post</span>
      <a href="{{ url_base }}{{ custom_prev.url }}" itemprop="item">{{ custom_prev.title }}</a>
      <meta itemprop="name" content="{{ custom_prev.title }}">
      <meta itemprop="position" content="1" />
    </div>
  {% else %}
    <div class="previous-post placeholder"></div>
  {% endif %}
  
  <div class="home-link" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <span class="nav-label">Blog Index</span>
    <a href="{{ url_base }}/" itemprop="item">Home</a>
    <meta itemprop="name" content="Home">
    <meta itemprop="position" content="2" />
  </div>
  
  {% if custom_next %}
    <div class="next-post" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <span class="nav-label">Next Post</span>
      <a href="{{ url_base }}{{ custom_next.url }}" itemprop="item">{{ custom_next.title }}</a>
      <meta itemprop="name" content="{{ custom_next.title }}">
      <meta itemprop="position" content="3" />
    </div>
  {% else %}
    <div class="next-post placeholder"></div>
  {% endif %}
</nav>

{% comment %}
  Calculate post number using the flat index position instead of backwards counting
  Reverse the numbering so newest posts (position 0) show as highest number
{% endcomment %}
{% assign total_posts = flat_index.size %}
{% assign post_number = total_posts | minus: current_position %}

<div class="post-counter" style="text-align: center; margin: 20px 0; font-style: italic;">
  <span>Post #{{ post_number }} of {{ total_posts }} - {{ page.date | date: '%B %-d, %Y' }}</span>
</div>

{% comment %} --- Display Top GSC Keywords (Comma Separated) --- {% endcomment %}
{% assign current_page_url = page.url %}
{% if current_page_url != '/' and current_page_url != '' %}
  {% unless current_page_url contains '/' %}{% assign current_page_url = current_page_url | append: '/' %}{% endunless %}
{% endif %}
{% assign top_keywords_list = site.data.gsc_top_keywords[current_page_url] %}

<div style="display: none;">
Debug Info:
Raw URL: {{ page.url }}
Normalized URL: {{ current_page_url }}
Has Keywords?: {% if top_keywords_list %}Yes ({{ top_keywords_list.size }}){% else %}No{% endif %}
First Few Keys: {% for key in site.data.gsc_top_keywords limit:5 %}{{ key[0] }}, {% endfor %}
</div>

{% if top_keywords_list and top_keywords_list.size > 0 %}
  {% comment %} Extract just the 'query' string from each keyword data object {% endcomment %}
  {% assign keyword_names = top_keywords_list | map: 'query' %}
  <div class="gsc-categories" style="text-align: center; margin: 10px 0 20px 0; font-style: italic; color: #999;">
    Found by: {{ keyword_names | join: ', ' }}
  </div>
{% endif %}
{% comment %} --- End Display Top GSC Keywords --- {% endcomment %}
